trigger:
  branches:
    include:
      - master

pool:
  vmImage: ubuntu-latest

variables:
  IMAGE_TAG: $(Build.SourceVersion)
  IMAGE_NAME: 'samples/test'

steps:
  - script: SHORT_SHA=$(echo $(Build.SourceVersion) | cut -c1-9); echo "##vso[task.setvariable variable=SHORT_SHA]$SHORT_SHA"
    displayName: 'Set short Git commit hash'

  - task: AzureContainerApps@1
    inputs:
      appSourcePath: '$(Build.SourcesDirectory)'
      azureSubscription: 'abdul-test-service-connection'
      acrName: 'abdultest20oct2025'
      containerAppName: 'abdultestca'
      resourceGroup: 'abdultestRG'
      imageToBuild: 'samples/test:$(SHORT_SHA)'
      imageToDeploy: 'samples/test:$(SHORT_SHA)'
      dockerfilePath: 'Dockerfile'